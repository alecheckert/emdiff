# emdiff
Maximum likelihood estimation for multi-state normal diffusion models

## What does it do?

`emdiff` is an analysis tool for trajectories generated by 
stroboscopic single particle tracking (SPT) experiments. Given
a set of trajectories, it estimates how many molecules are in 
distinct diffusive states, and the diffusion coefficient corresponding
to each state.

`emdiff` models a set of trajectories as an unknown mixture of 
normal diffusive components. Each component is characterized by 
a diffusion coefficient.

## What doesn't it do?

`emdiff` does not check the quality of your raw data.

`emdiff` does not filter out any data. It will consider whatever
data you give it. There is a single optional filter to exclude
trajectories before a start frame, but that's it.

`emdiff` does not decide how many diffusive states are present
in your data.

`emdiff` does not provide any visualizations of the result.

`emdiff` expects you to understand your own experiment, knowing
the frame interval, approximate localization error, and pixel size.

While `emdiff` supports analysis in any number of spatial dimensions,
it uses the same localization error along each dimension. This is 
generally not true for SPT experiments in 3D with increased axial 
localization error.

## Expected input

`emdiff` takes trajectories as a `pandas.DataFrame`. Each row of 
the dataframe should correspond to a localization from an SPT
experiment. The dataframe must contain at minimum:

 - a `trajectory` column, with the index of the trajectory to which that localization corresponds;
 - a `frame` column, with the index of the corresponding frame;
 - columns such as `y` and `x` with the spatial coordinates of the localization **in pixels**

## Example usage
```
    from emdiff import emdiff
    state_occupations, diff_coefs = emdiff(
        tracks,
        n_states=2,
        pixel_size_um=1.0,       # um
        frame_interval=0.00748,  # seconds
        loc_error=0.035          # um
    )
```

## What do I do with the result?

Up to you.

## But I don't know the localization error for my experiment.

There are various ways to estimate the localization
error in an SPT experiment. `emdiff` provides one:
```
    from emdiff import calc_le
    loc_error = calc_le(
        tracks, 
        pixel_size_um=0.16,
        pos_cols=['y', 'x']
    )
```

The localization error represents the root 1D localization variance,
estimated using the covariance between subsequent displacements in 
a set of trajectories. It gets more accurate as you use more 
trajectories.

If this localization error seems large, then that's probably 
because it actually is. Moving molecules produce a lot of error.


